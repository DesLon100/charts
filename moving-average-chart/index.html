<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Monthly Moving Average</title>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

<style>
  body {
    margin: 0;
    padding: 14px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: #fff; /* TEMP: force visible */
  }
  .wrap { max-width: 645px; }

  .boot {
    background: #fffbcc;
    border: 1px solid #e6d56a;
    border-radius: 10px;
    padding: 10px 12px;
    margin-bottom: 10px;
    font-size: 13px;
  }

  .controls {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
    align-items: center;
  }

  input[type="file"] { height: 40px; background: #fff; }
  select {
    height: 40px;
    border-radius: 10px;
    border: 1px solid #ccc;
    background: #fff;
    padding: 0 12px;
    font-size: 14px;
  }

  #chart { width: 100%; height: 360px; border: 1px dashed #ddd; border-radius: 10px; }

  #status {
    margin-top: 8px;
    font-size: 12px;
    background: #fff;
    padding: 8px 10px;
    border: 1px solid #ddd;
    border-radius: 10px;
    display: block; /* TEMP: always visible */
    white-space: pre-wrap;
  }
</style>
</head>

<body>
<div class="wrap">

  <!-- This should ALWAYS show if the HTML is the one you uploaded -->
  <div class="boot" id="htmlBoot">HTML LOADED ✅ (if you can see this, you are viewing the correct file)</div>

  <div class="controls">
    <input type="file" id="fileInput" accept=".csv">
    <select id="windowSelect">
      <option value="12">12-month avg</option>
      <option value="24">24-month avg</option>
      <option value="36">36-month avg</option>
    </select>
  </div>

  <div id="chart"></div>
  <div id="status">Status box visible ✅ (JS will update this)</div>

  <noscript>
    <div class="boot">JavaScript is disabled in this browser/session.</div>
  </noscript>
</div>

<script>
  // If you see this message appear, JS is definitely running.
  const statusEl = document.getElementById("status");
  statusEl.textContent = "JS RUNNING ✅ (now load a CSV)";

  window.addEventListener("error", (e) => {
    statusEl.textContent = "JS error:\n" + (e.message || e.type) + "\n" + (e.filename || "") + ":" + (e.lineno || "");
  });

  window.addEventListener("unhandledrejection", (e) => {
    const msg = (e && e.reason && (e.reason.message || String(e.reason))) || "Unknown rejection";
    statusEl.textContent = "Unhandled promise rejection:\n" + msg;
  });

  if (typeof Plotly === "undefined") {
    statusEl.textContent = "Plotly failed to load ❌ (blocked CDN or no internet).";
  }

  // Minimal file-load test (just to prove the input fires)
  const fileInput = document.getElementById("fileInput");
  fileInput.addEventListener("change", async () => {
    const file = fileInput.files?.[0];
    if (!file) return;
    const text = await file.text();
    statusEl.textContent = "CSV selected ✅\nFirst 200 chars:\n" + text.slice(0, 200);
  });
</script>

</body>
</html>
