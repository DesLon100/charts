<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Monthly Moving Average</title>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

<style>
  body {
    margin: 0;
    padding: 14px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: transparent;
  }
  .wrap { max-width: 645px; }

  .controls {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
    align-items: center;
  }

  input[type="file"] { height: 40px; background: #fff; }
  select {
    height: 40px;
    border-radius: 10px;
    border: 1px solid #ccc;
    background: #fff;
    padding: 0 12px;
    font-size: 14px;
  }

  #chart { width: 100%; height: 360px; }

  #status {
    margin-top: 8px;
    font-size: 12px;
    background: #fff;
    padding: 8px 10px;
    border: 1px solid #ddd;
    border-radius: 10px;
    display: none;
    white-space: pre-wrap;
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="controls">
    <input type="file" id="fileInput" accept=".csv">
    <select id="windowSelect">
      <option value="12">12-month avg</option>
      <option value="24">24-month avg</option>
      <option value="36">36-month avg</option>
    </select>
  </div>

  <div id="chart"></div>
  <div id="status"></div>
</div>

<script>
  const fileInput = document.getElementById("fileInput");
  const windowSelect = document.getElementById("windowSelect");
  const statusEl = document.getElementById("status");

  function status(msg) {
    statusEl.textContent = msg;
    statusEl.style.display = "block";
  }
  function clearStatus() {
    statusEl.textContent = "";
    statusEl.style.display = "none";
  }

  // Show any JS errors ON the page (no more guessing)
  window.addEventListener("error", (e) => {
    status("JS error:\n" + (e.message || e.type) + "\n" + (e.filename || "") + ":" + (e.lineno || ""));
  });

  // Also catch promise rejections
  window.addEventListener("unhandledrejection", (e) => {
    const msg = (e && e.reason && (e.reason.message || String(e.reason))) || "Unknown rejection";
    status("Unhandled promise rejection:\n" + msg);
  });

  if (typeof Plotly === "undefined") {
    status("Plotly failed to load. Check your internet or blocked scripts.");
  } else {
    status("Page loaded. Upload a CSV to render the chart.");
    setTimeout(clearStatus, 1200);
